<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nauka Niemieckich Czasownik贸w</title>    <style>
        :root {
            --bg-color: #f5f5f5;
            --text-color: #333;
            --container-bg: white;
            --container-shadow: rgba(0, 0, 0, 0.1);
            --heading-color: #2c3e50;
            --input-bg: white;
            --input-border: #ddd;
            --correct-color: #27ae60;
            --incorrect-color: #c0392b;
            --hint-color: #7f8c8d;
            --stats-bg: #ecf0f1;
            --progress-bg: #e9ecef;
            --help-bg: #f8f9fa;
            --vocabulary-bg: #f8f9fa;
            --vocabulary-border: #ddd;
            --btn-primary-bg: #3498db;
            --btn-primary-color: white;
            --btn-hover-bg: #2980b9;
        }
        
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #121212;
                --text-color: #e0e0e0;
                --container-bg: #1e1e1e;
                --container-shadow: rgba(0, 0, 0, 0.3);
                --heading-color: #81a1c1;
                --input-bg: #2e2e2e;
                --input-border: #555;
                --correct-color: #4eca7a;
                --incorrect-color: #e06c75;
                --hint-color: #a0a0a0;
                --stats-bg: #2a2a2a;
                --progress-bg: #333;
                --help-bg: #252525;
                --vocabulary-bg: #252525;
                --vocabulary-border: #555;
                --btn-primary-bg: #4c8dae;
                --btn-primary-color: #e0e0e0;
                --btn-hover-bg: #5f9fc2;
            }
        }
          body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
            max-width: 800px;
            margin: 0 auto;
            transition: background-color 0.3s, color 0.3s;
        }
        
        /* Responsywno dla urzdze mobilnych */
        @media (max-width: 768px) {
            body {
                padding: 10px;
                max-width: 100%;
            }
            
            h1 {
                font-size: 1.5em;
                margin-bottom: 20px;
            }
            
            .container {
                padding: 15px;
                margin-bottom: 15px;
                border-radius: 6px;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            
            h1 {
                font-size: 1.3em;
                margin-bottom: 15px;
            }
            
            .container {
                padding: 10px;
                margin-bottom: 10px;
            }
        }
        
        h1 {
            text-align: center;
            color: var(--heading-color);
            margin-bottom: 30px;
        }
        
        .container {
            background-color: var(--container-bg);
            border-radius: 8px;
            box-shadow: 0 4px 8px var(--container-shadow);
            padding: 20px;
            margin-bottom: 20px;
        }        .block-selector {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .block-btn {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.1s, opacity 0.1s;
            min-width: 120px;
            text-align: center;
        }
        
        /* Responsywno dla przycisk贸w blok贸w */
        @media (max-width: 768px) {
            .block-selector {
                gap: 8px;
                margin-bottom: 15px;
            }
            
            .block-btn {
                padding: 12px 10px;
                font-size: 14px;
                min-width: 100px;
                flex: 1 1 calc(50% - 4px);
                max-width: calc(50% - 4px);
            }
        }
        
        @media (max-width: 480px) {
            .block-selector {
                gap: 6px;
                margin-bottom: 10px;
            }
            
            .block-btn {
                padding: 10px 8px;
                font-size: 12px;
                min-width: 80px;
                flex: 1 1 calc(50% - 3px);
                max-width: calc(50% - 3px);
            }
        }
        
        .block-btn:hover {
            transform: translateY(-2px);
        }
        
        .block-btn:active {
            transform: translateY(0);
            opacity: 0.8;
        }
        
        .block-btn-1 { background-color: #3498db; color: white; }
        .block-btn-2 { background-color: #2ecc71; color: white; }
        .block-btn-3 { background-color: #f1c40f; color: #333; }
        .block-btn-4 { background-color: #e74c3c; color: white; }
        .block-btn-5 { background-color: #9b59b6; color: white; }
        .block-btn-all { background-color: #34495e; color: white; }
          .learning-area {
            text-align: center;
            margin-top: 20px;
        }
        
        .word-display {
            font-size: 24px;
            margin-bottom: 20px;
            min-height: 36px;
        }
        
        .polish-word {
            font-weight: bold;
            color: var(--heading-color);
        }
        
        .input-area {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .form-label {
            width: 120px;
            text-align: right;
            font-weight: bold;
        }
        
        input {
            padding: 8px 12px;
            border: 1px solid var(--input-border);
            border-radius: 4px;
            width: 200px;
            font-size: 16px;
            background-color: var(--input-bg);
            color: var(--text-color);
        }
        
        /* Responsywno dla obszaru nauki */
        @media (max-width: 768px) {
            .learning-area {
                margin-top: 15px;
            }
            
            .word-display {
                font-size: 20px;
                margin-bottom: 15px;
                min-height: 30px;
            }
            
            .input-area {
                gap: 8px;
                margin-bottom: 15px;
            }
            
            .form-group {
                flex-direction: column;
                gap: 5px;
            }
            
            .form-label {
                width: auto;
                text-align: center;
                font-size: 14px;
            }
            
            input {
                width: 100%;
                max-width: 280px;
                font-size: 16px;
                padding: 10px 12px;
            }
            
            button {
                padding: 12px 20px;
                font-size: 16px;
                margin: 5px;
                min-width: 120px;
            }
        }
        
        @media (max-width: 480px) {
            .word-display {
                font-size: 18px;
                margin-bottom: 12px;
            }
            
            .input-area {
                gap: 6px;
                margin-bottom: 12px;
            }
            
            .form-label {
                font-size: 13px;
            }
            
            input {
                max-width: 100%;
                font-size: 16px;
                padding: 12px;
            }
            
            button {
                padding: 14px 20px;
                font-size: 16px;
                width: 100%;
                max-width: 200px;
            }
        }
        
        button {
            padding: 10px 15px;
            background-color: var(--btn-primary-bg);
            color: var(--btn-primary-color);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.2s;
        }
        
        button:hover {
            background-color: var(--btn-hover-bg);
        }
        
        .result {
            font-size: 18px;
            margin-top: 20px;
            min-height: 27px;
        }
        
        .correct {
            color: var(--correct-color);
            font-weight: bold;
        }
        
        .incorrect {
            color: var(--incorrect-color);
            font-weight: bold;
        }        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            background-color: var(--stats-bg);
            border-radius: 4px;
            padding: 10px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--heading-color);
        }
        
        /* Responsywno dla statystyk */
        @media (max-width: 768px) {
            .stats {
                margin-top: 15px;
                padding: 8px;
                gap: 5px;
            }
            
            .stat-item {
                font-size: 14px;
            }
            
            .stat-value {
                font-size: 20px;
            }
            
            .result {
                font-size: 16px;
                margin-top: 15px;
                min-height: 24px;
                padding: 0 10px;
            }
        }
        
        @media (max-width: 480px) {
            .stats {
                flex-wrap: wrap;
                gap: 10px;
                padding: 10px 5px;
            }
            
            .stat-item {
                flex: 1 1 calc(50% - 5px);
                min-width: calc(50% - 5px);
                font-size: 13px;
            }
            
            .stat-value {
                font-size: 18px;
            }
            
            .result {
                font-size: 15px;
                margin-top: 12px;
                line-height: 1.4;
            }
        }
        
        .hint {
            color: var(--hint-color);
            font-style: italic;
            margin-top: 5px;
        }
        
        .feedback {
            margin-top: 15px;
        }
        
        .verb-progress {
            margin-top: 20px;
            padding: 10px;
            background-color: var(--help-bg);
            border-radius: 4px;
            border: 1px solid var(--input-border);
        }
        
        .progress-title {
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .progress-bar-container {
            height: 20px;
            background-color: var(--progress-bg);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background-color: var(--btn-primary-bg);
            transition: width 0.3s ease;
        }
        
        .help-section {
            margin-top: 20px;
            padding: 15px;
            background-color: var(--help-bg);
            border-radius: 4px;
            border-left: 4px solid var(--btn-primary-bg);
        }
        
        .hidden {
            display: none;
        }
        
        .show-vocabulary {
            margin-top: 10px;
            text-align: right;
        }
        
        .vocabulary-toggle {
            background-color: transparent;
            color: var(--hint-color);
            border: 1px solid var(--input-border);
            font-size: 14px;
        }
        
        .vocabulary-list {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
            background-color: var(--vocabulary-bg);
            border-radius: 4px;
            margin-top: 10px;
        }
        
        .vocabulary-list.show {
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid var(--vocabulary-border);
        }
        
        .vocabulary-item {
            padding: 5px 0;
            border-bottom: 1px solid var(--input-border);
        }
        
        .vocabulary-item:last-child {
            border-bottom: none;
        }
          .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: transparent;
            border: 1px solid var(--input-border);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .theme-toggle:hover {
            background-color: var(--stats-bg);
        }
        
        /* Responsywno dla przecznika motywu */
        @media (max-width: 768px) {
            .theme-toggle {
                top: 10px;
                right: 10px;
                width: 35px;
                height: 35px;
            }
            
            .help-section {
                margin-top: 15px;
                padding: 12px;
                font-size: 14px;
            }
            
            .help-section h3 {
                font-size: 16px;
                margin-bottom: 10px;
            }
            
            .help-section ol {
                padding-left: 18px;
            }
            
            .verb-progress {
                margin-top: 15px;
                padding: 8px;
            }
            
            .progress-title {
                font-size: 14px;
                margin-bottom: 8px;
            }
            
            .show-vocabulary {
                margin-top: 8px;
                text-align: center;
            }
            
            .vocabulary-toggle {
                font-size: 13px;
                padding: 8px 12px;
            }
        }
        
        @media (max-width: 480px) {
            .theme-toggle {
                top: 5px;
                right: 5px;
                width: 32px;
                height: 32px;
            }
            
            .help-section {
                margin-top: 10px;
                padding: 10px;
                font-size: 13px;
            }
            
            .help-section h3 {
                font-size: 15px;
            }
            
            .verb-progress {
                margin-top: 10px;
                padding: 6px;
            }
            
            .progress-title {
                font-size: 13px;
            }
            
            .vocabulary-toggle {
                font-size: 12px;
                padding: 6px 10px;
            }
        }
          .tutorial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .tutorial-overlay.hidden {
            display: none !important;
        }
        
        .tutorial-content {
            background-color: var(--container-bg);
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
            padding: 30px;
            max-width: 80%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .tutorial-step {
            margin-bottom: 20px;
        }
        
        /* Responsywno dla samouczka */
        @media (max-width: 768px) {
            .tutorial-content {
                max-width: 95%;
                max-height: 90vh;
                padding: 20px;
                margin: 10px;
            }
            
            .tutorial-step {
                margin-bottom: 15px;
            }
            
            .tutorial-step h2 {
                font-size: 18px;
                margin-bottom: 10px;
            }
            
            .tutorial-step p, .tutorial-step li {
                font-size: 14px;
                line-height: 1.5;
            }
            
            .tutorial-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .tutorial-nav-btn {
                width: 100%;
                padding: 12px 16px;
                font-size: 14px;
            }
        }
        
        @media (max-width: 480px) {
            .tutorial-content {
                max-width: 98%;
                max-height: 95vh;
                padding: 15px;
                margin: 5px;
                border-radius: 6px;
            }
            
            .tutorial-step h2 {
                font-size: 16px;
            }
            
            .tutorial-step p, .tutorial-step li {
                font-size: 13px;
            }
            
            .tutorial-nav-btn {
                padding: 14px 16px;
                font-size: 15px;
            }
        }
        
        .tutorial-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
          .tutorial-nav-btn {
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            border: 1px solid var(--btn-primary-bg);
            background-color: var(--btn-primary-bg);
            color: var(--btn-primary-color);
        }
        
        .tutorial-skip {
            background-color: transparent !important;
            border: 1px solid var(--input-border) !important;
            color: var(--text-color) !important;
        }
        
        .tutorial-example {
            border: 1px dashed var(--input-border);
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        
        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: var(--container-bg);
            color: var(--text-color);
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            border: 1px solid var(--input-border);
            box-shadow: 0 4px 8px var(--container-shadow);
        }
        
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        /* Usprawnienia dotykowe dla urzdze mobilnych */
        @media (max-width: 768px) {
            /* Wiksze obszary dotykowe */
            .block-btn:hover {
                transform: none; /* Wyczamy hover efekty na mobile */
            }
            
            .block-btn:active {
                transform: scale(0.95);
                opacity: 0.8;
            }
            
            /* Lepsze dotykanie przycisk贸w */
            button {
                min-height: 44px; /* Apple guidelines */
                touch-action: manipulation; /* Zapobiega zoom przy tap */
            }
            
            input {
                min-height: 44px;
                touch-action: manipulation;
            }
            
            /* Zapobieganie zoom przy focus na input */
            input:focus {
                outline: 2px solid var(--btn-primary-bg);
                outline-offset: 2px;
            }
        }
        
        /* Dodatkowe usprawnienia dla bardzo maych ekran贸w */
        @media (max-width: 320px) {
            body {
                padding: 3px;
            }
            
            .container {
                padding: 8px;
            }
            
            h1 {
                font-size: 1.2em;
            }
            
            .word-display {
                font-size: 16px;
            }
            
            input {
                font-size: 16px; /* Zapobiega zoom na iOS */
                padding: 14px 12px;
            }
            
            button {
                padding: 16px 20px;
                font-size: 15px;
            }
        }
    </style>
</head>
<body>    <h1>Nauka Niemieckich Czasownik贸w</h1>
    
    <button id="theme-toggle" class="theme-toggle" title="Zmie motyw">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
    </button>
    
    <div class="container">
        <div class="block-selector">
            <button class="block-btn block-btn-1" data-block="1">Blok 1 (1-12)</button>
            <button class="block-btn block-btn-2" data-block="2">Blok 2 (13-24)</button>
            <button class="block-btn block-btn-3" data-block="3">Blok 3 (25-36)</button>
            <button class="block-btn block-btn-4" data-block="4">Blok 4 (37-48)</button>
            <button class="block-btn block-btn-5" data-block="5">Blok 5 (49-60)</button>
            <button class="block-btn block-btn-all" data-block="all">Wszystkie</button>
        </div>
        
        <div class="learning-area hidden">
            <div class="word-display">
                <div class="polish-word"></div>
            </div>
            
            <div class="input-area">                <div class="form-group">
                    <div class="form-label">Bezokolicznik:</div>
                    <input type="text" id="infinitive" placeholder="np. gehen">
                    <div class="tooltip">?
                        <span class="tooltip-text">Podstawowa forma czasownika (odpowiada na pytanie: co robi?)</span>
                    </div>
                </div>
                <div class="form-group">
                    <div class="form-label">Pr盲teritum:</div>
                    <input type="text" id="preterite" placeholder="np. ging">
                    <div class="tooltip">?
                        <span class="tooltip-text">Forma czasu przeszego prostego (u偶ywana g贸wnie w tekstach pisanych)</span>
                    </div>
                </div>
                <div class="form-group">
                    <div class="form-label">Perfekt:</div>
                    <input type="text" id="perfect" placeholder="np. gegangen">
                    <div class="tooltip">?
                        <span class="tooltip-text">Forma imiesowu czasu przeszego (u偶ywana do tworzenia czasu Perfekt)</span>
                    </div>
                </div>
            </div>
            
            <button id="check-btn">Sprawd藕</button>
            <button id="next-btn" class="hidden">Nastpne sowo</button>
            
            <div class="result"></div>
            <div class="feedback hidden"></div>
            
            <div class="stats">
                <div class="stat-item">
                    <div>Punkty</div>
                    <div class="stat-value" id="points">0</div>
                </div>
                <div class="stat-item">
                    <div>Poprawne</div>
                    <div class="stat-value" id="correct">0</div>
                </div>
                <div class="stat-item">
                    <div>Bdne</div>
                    <div class="stat-value" id="incorrect">0</div>
                </div>
                <div class="stat-item">
                    <div>Pozostao</div>
                    <div class="stat-value" id="remaining">0</div>
                </div>
            </div>
            
            <div class="verb-progress">
                <div class="progress-title">Postp nauki:</div>
                <div class="progress-bar-container">
                    <div class="progress-bar" style="width: 0%"></div>
                </div>
            </div>
            
            <div class="show-vocabulary">
                <button class="vocabulary-toggle">Poka偶 sownictwo</button>
            </div>
            
            <div class="vocabulary-list">
                <!-- Tutaj bdzie dynamicznie generowana lista sownictwa -->
            </div>
        </div>
          <div class="start-info">
            <h2>Witaj w aplikacji do nauki niemieckich czasownik贸w nieregularnych!</h2>
            <p>Ta aplikacja pomo偶e Ci nauczy si niemieckich czasownik贸w nieregularnych w ich trzech podstawowych formach: bezokolicznik (Infinitiv), czas przeszy prosty (Pr盲teritum) i imies贸w czasu przeszego (Perfekt).</p>
            <p>Aby rozpocz nauk, wybierz jeden z blok贸w powy偶ej. Zobaczysz polskie tumaczenie, a Twoim zadaniem bdzie wpisanie trzech form niemieckiego czasownika.</p>
            <p>Za ka偶d poprawn odpowied藕 otrzymasz punkty. Im wicej form podasz poprawnie, tym wicej punkt贸w zdobdziesz!</p>
            <p>Powodzenia w nauce! </p>
            <button id="start-tutorial" class="tutorial-nav-btn">Poka偶 samouczek</button>
        </div>
    </div>    <div class="help-section">
        <h3>Jak korzysta z aplikacji?</h3>
        <ol>
            <li>Wybierz blok czasownik贸w, kt贸rych chcesz si uczy.</li>
            <li>Zobaczysz polskie znaczenie czasownika.</li>
            <li>Wpisz trzy formy niemieckiego czasownika (bezokolicznik, Pr盲teritum, Perfekt).</li>
            <li>Nacinij "Sprawd藕", aby sprawdzi swoje odpowiedzi.</li>
            <li>Zobaczysz, kt贸re formy s poprawne, a kt贸re nie.</li>
            <li>Nacinij "Nastpne sowo", aby przej do kolejnego czasownika.</li>
        </ol>
        <p><strong>System nauki adaptacyjnej:</strong> Na pocztku wszystkie sowa bloku s dodawane do puli nauki. Aby usun s贸wko z puli, musisz poda wszystkie trzy formy poprawnie dwa razy. Ka偶da niepoprawna odpowied藕 resetuje licznik dla danego sowa.</p>
        <p>Wskaz贸wka: Mo偶esz u偶y klawisza Tab, aby przechodzi midzy polami, a Enter, aby sprawdzi odpowiedzi.</p>
    </div>
    
    <!-- Samouczek -->
    <div id="tutorial-overlay" class="tutorial-overlay hidden">
        <div class="tutorial-content">
            <div id="tutorial-step-1" class="tutorial-step">
                <h2>Podstawy jzyka niemieckiego - Wprowadzenie</h2>
                <p>Witaj w samouczku! Zanim zaczniesz nauk czasownik贸w nieregularnych, poznaj kilka podstawowych informacji o jzyku niemieckim:</p>
                <ul>
                    <li>W jzyku niemieckim wszystkie rzeczowniki piszemy <strong>wielk liter</strong> (np. das Haus - dom)</li>
                    <li>Czasowniki (kt贸re bdziesz si uczy w tej aplikacji) opisuj czynnoci</li>
                    <li>Czasowniki nieregularne zmieniaj swoj form w r贸偶nych czasach w spos贸b, kt贸ry trzeba po prostu zapamita</li>
                </ul>
            </div>
            
            <div id="tutorial-step-2" class="tutorial-step hidden">
                <h2>Trzy formy czasownika</h2>
                <p>W tej aplikacji bdziesz uczy si trzech form ka偶dego czasownika:</p>
                <ol>
                    <li><strong>Bezokolicznik (Infinitiv)</strong> - podstawowa forma czasownika, np. "gehen" (i)</li>
                    <li><strong>Pr盲teritum</strong> - forma czasu przeszego u偶ywana g贸wnie w jzyku pisanym, np. "ging" (szed)</li>
                    <li><strong>Perfekt</strong> - imies贸w czasu przeszego u偶ywany do tworzenia czasu Perfekt, np. "gegangen" (poszed)</li>
                </ol>
                <p>Przykad penego zdania z czasem Perfekt: "Ich bin nach Hause gegangen" (Poszedem do domu)</p>
            </div>
            
            <div id="tutorial-step-3" class="tutorial-step hidden">
                <h2>Jak korzysta z aplikacji</h2>
                <p>Oto jak dziaa nasza aplikacja:</p>
                <ol>
                    <li>Wybierz blok czasownik贸w, kt贸rych chcesz si uczy</li>
                    <li>Zobaczysz polskie tumaczenie czasownika</li>
                    <li>Wpisz trzy formy niemieckiego czasownika w odpowiednich polach</li>
                    <li>Kliknij "Sprawd藕", aby sprawdzi swoje odpowiedzi</li>
                </ol>
                <div class="tutorial-example">
                    <p>Przykad:</p>
                    <p>Polskie sowo: <strong>i</strong></p>
                    <p>Poprawne odpowiedzi:</p>
                    <ul>
                        <li>Bezokolicznik: <strong>gehen</strong></li>
                        <li>Pr盲teritum: <strong>ging</strong></li>
                        <li>Perfekt: <strong>gegangen</strong></li>
                    </ul>
                </div>
            </div>
              <div id="tutorial-step-4" class="tutorial-step hidden">
                <h2>System adaptacyjnych powt贸rek</h2>
                <p>Nasza aplikacja wykorzystuje inteligentny system adaptacyjnych powt贸rek:</p>
                <ul>
                    <li><strong>Sowo musi by odpowiedziane poprawnie 2 razy z rzdu</strong>, aby zostao uznane za opanowane</li>
                    <li>Ka偶da bdna odpowied藕 resetuje licznik poprawnych odpowiedzi dla danego sowa</li>
                    <li>Sowa, kt贸re sprawiaj trudno, trafiaj na list powt贸rek</li>
                    <li>System automatycznie skupia si na sowach, kt贸re sprawiaj Ci najwicej problem贸w</li>
                    <li>Po opanowaniu wszystkich s贸w z bloku, blok zostaje oznaczony jako ukoczony</li>
                </ul>
                <p>Dziki temu systemowi skupiasz si na sowach, kt贸re naprawd wymagaj powt贸rzenia, a nie tracisz czasu na te, kt贸re ju偶 dobrze znasz!</p>
            </div>
            
            <div id="tutorial-step-5" class="tutorial-step hidden">
                <h2>Wskaz贸wki do nauki</h2>
                <p>Oto kilka wskaz贸wek, kt贸re pomog Ci w nauce niemieckich czasownik贸w:</p>
                <ul>
                    <li>Ucz si regularnie, najlepiej codziennie po 10-15 minut</li>
                    <li>Zwracaj uwag na wzorce - wiele czasownik贸w ma podobne zmiany form</li>
                    <li>U偶ywaj nauczonych czasownik贸w w zdaniach, aby lepiej je zapamita</li>
                    <li>Nie zniechcaj si bdami - s naturaln czci procesu nauki</li>
                    <li>Mo偶esz zawsze sprawdzi list sownictwa, klikajc przycisk "Poka偶 sownictwo"</li>
                </ul>
            </div><div class="tutorial-buttons">
                <button id="tutorial-prev" class="tutorial-nav-btn" disabled>Wstecz</button>
                <button id="tutorial-skip" class="tutorial-nav-btn tutorial-skip">Pomi samouczek</button>
                <button id="tutorial-next" class="tutorial-nav-btn">Dalej</button>
            </div>
        </div>
    </div>
    
    <script>
        // Baza danych czasownik贸w
        const verbBlocks = {
            1: [
                { infinitive: "backen", preterite: "buk", perfect: "gebacken", polish: "piec" },
                { infinitive: "beginnen", preterite: "begann", perfect: "begonnen", polish: "zaczyna" },
                { infinitive: "bitten", preterite: "bat", perfect: "gebeten", polish: "prosi" },
                { infinitive: "bleiben", preterite: "blieb", perfect: "geblieben", polish: "zostawa" },
                { infinitive: "bringen", preterite: "brachte", perfect: "gebracht", polish: "przynosi" },
                { infinitive: "denken", preterite: "dachte", perfect: "gedacht", polish: "myle" },
                { infinitive: "d眉rfen", preterite: "durfte", perfect: "gedurft", polish: "mie pozwolenie" },
                { infinitive: "essen", preterite: "a", perfect: "gegessen", polish: "je" },
                { infinitive: "fahren", preterite: "fuhr", perfect: "gefahren", polish: "jecha" },
                { infinitive: "fallen", preterite: "fiel", perfect: "gefallen", polish: "upada" },
                { infinitive: "fangen", preterite: "fing", perfect: "gefangen", polish: "apa" },
                { infinitive: "finden", preterite: "fand", perfect: "gefunden", polish: "znajdowa" }
            ],
            2: [
                { infinitive: "fliegen", preterite: "flog", perfect: "geflogen", polish: "lata" },
                { infinitive: "geben", preterite: "gab", perfect: "gegeben", polish: "dawa" },
                { infinitive: "gehen", preterite: "ging", perfect: "gegangen", polish: "i" },
                { infinitive: "geschehen", preterite: "geschah", perfect: "geschehen", polish: "wydarzy si" },
                { infinitive: "gewinnen", preterite: "gewann", perfect: "gewonnen", polish: "wygrywa" },
                { infinitive: "haben", preterite: "hatte", perfect: "gehabt", polish: "mie" },
                { infinitive: "halten", preterite: "hielt", perfect: "gehalten", polish: "trzyma" },
                { infinitive: "heien", preterite: "hie", perfect: "geheien", polish: "nazywa si" },
                { infinitive: "helfen", preterite: "half", perfect: "geholfen", polish: "pomaga" },
                { infinitive: "kennen", preterite: "kannte", perfect: "gekannt", polish: "zna" },
                { infinitive: "kommen", preterite: "kam", perfect: "gekommen", polish: "przychodzi" },
                { infinitive: "k枚nnen", preterite: "konnte", perfect: "gekonnt", polish: "m贸c, potrafi" }
            ],
            3: [
                { infinitive: "laufen", preterite: "lief", perfect: "gelaufen", polish: "biega" },
                { infinitive: "leihen", preterite: "lieh", perfect: "geliehen", polish: "po偶ycza" },
                { infinitive: "lesen", preterite: "las", perfect: "gelesen", polish: "czyta" },
                { infinitive: "liegen", preterite: "lag", perfect: "gelegen", polish: "le偶e" },
                { infinitive: "nehmen", preterite: "nahm", perfect: "genommen", polish: "bra" },
                { infinitive: "raten", preterite: "riet", perfect: "geraten", polish: "radzi" },
                { infinitive: "reiten", preterite: "ritt", perfect: "geritten", polish: "jecha konno" },
                { infinitive: "rufen", preterite: "rief", perfect: "gerufen", polish: "woa" },
                { infinitive: "schlafen", preterite: "schlief", perfect: "geschlafen", polish: "spa" },
                { infinitive: "schlagen", preterite: "schlug", perfect: "geschlagen", polish: "bi" },
                { infinitive: "schlieen", preterite: "schloss", perfect: "geschlossen", polish: "zamyka" },
                { infinitive: "schneiden", preterite: "schnitt", perfect: "geschnitten", polish: "kroi" }
            ],
            4: [
                { infinitive: "schreiben", preterite: "schrieb", perfect: "geschrieben", polish: "pisa" },
                { infinitive: "schwimmen", preterite: "schwamm", perfect: "geschwommen", polish: "pywa" },
                { infinitive: "sehen", preterite: "sah", perfect: "gesehen", polish: "widzie" },
                { infinitive: "sein", preterite: "war", perfect: "gewesen", polish: "by" },
                { infinitive: "singen", preterite: "sang", perfect: "gesungen", polish: "piewa" },
                { infinitive: "sitzen", preterite: "sa", perfect: "gesessen", polish: "siedzie" },
                { infinitive: "sprechen", preterite: "sprach", perfect: "gesprochen", polish: "m贸wi" },
                { infinitive: "springen", preterite: "sprang", perfect: "gesprungen", polish: "skaka" },
                { infinitive: "stehen", preterite: "stand", perfect: "gestanden", polish: "sta" },
                { infinitive: "steigen", preterite: "stieg", perfect: "gestiegen", polish: "wspina si" },
                { infinitive: "sterben", preterite: "starb", perfect: "gestorben", polish: "umiera" },
                { infinitive: "streiten", preterite: "stritt", perfect: "gestritten", polish: "k贸ci si" }
            ],
            5: [
                { infinitive: "tragen", preterite: "trug", perfect: "getragen", polish: "nosi" },
                { infinitive: "treffen", preterite: "traf", perfect: "getroffen", polish: "spotyka" },
                { infinitive: "trinken", preterite: "trank", perfect: "getrunken", polish: "pi" },
                { infinitive: "tun", preterite: "tat", perfect: "getan", polish: "robi" },
                { infinitive: "vergessen", preterite: "verga", perfect: "vergessen", polish: "zapomina" },
                { infinitive: "verlieren", preterite: "verlor", perfect: "verloren", polish: "gubi" },
                { infinitive: "waschen", preterite: "wusch", perfect: "gewaschen", polish: "my, pra" },
                { infinitive: "werden", preterite: "wurde", perfect: "geworden", polish: "stawa si" },
                { infinitive: "wissen", preterite: "wusste", perfect: "gewusst", polish: "wiedzie" },
                { infinitive: "ziehen", preterite: "zog", perfect: "gezogen", polish: "cign" },
                { infinitive: "verschwinden", preterite: "verschwand", perfect: "verschwunden", polish: "znika" },
                { infinitive: "einladen", preterite: "lud ein", perfect: "eingeladen", polish: "zaprasza" }
            ]
        };

        // Elementy DOM
        const learningArea = document.querySelector('.learning-area');
        const startInfo = document.querySelector('.start-info');
        const polishWord = document.querySelector('.polish-word');
        const infinitiveInput = document.getElementById('infinitive');
        const preteriteInput = document.getElementById('preterite');
        const perfectInput = document.getElementById('perfect');
        const checkBtn = document.getElementById('check-btn');
        const nextBtn = document.getElementById('next-btn');
        const resultDisplay = document.querySelector('.result');
        const feedbackDisplay = document.querySelector('.feedback');
        const pointsDisplay = document.getElementById('points');
        const correctDisplay = document.getElementById('correct');
        const incorrectDisplay = document.getElementById('incorrect');
        const remainingDisplay = document.getElementById('remaining');
        const progressBar = document.querySelector('.progress-bar');
        const vocabularyToggle = document.querySelector('.vocabulary-toggle');
        const vocabularyList = document.querySelector('.vocabulary-list');
        const themeToggle = document.getElementById('theme-toggle');
        const tutorialOverlay = document.getElementById('tutorial-overlay');
        const startTutorialBtn = document.getElementById('start-tutorial');
        const tutorialPrevBtn = document.getElementById('tutorial-prev');
        const tutorialNextBtn = document.getElementById('tutorial-next');
        const tutorialSkipBtn = document.getElementById('tutorial-skip');        const tutorialSteps = [
            document.getElementById('tutorial-step-1'),
            document.getElementById('tutorial-step-2'),
            document.getElementById('tutorial-step-3'),
            document.getElementById('tutorial-step-4'),
            document.getElementById('tutorial-step-5')
        ];
        
        // Zmienne stanu aplikacji
        let currentVerbs = [];          // Aktualna pula s贸w do nauki
        let currentVerbIndex = 0;       // Indeks aktualnego sowa
        let currentVerb = null;         // Aktualnie wywietlane sowo
        let points = 0;                 // Punkty zdobyte przez u偶ytkownika
        let correctAnswers = 0;         // Liczba poprawnych odpowiedzi
        let incorrectAnswers = 0;       // Liczba niepoprawnych odpowiedzi
        let userProgress = {};          // Postp u偶ytkownika
        let currentTutorialStep = 0;    // Aktualny krok samouczka
        let userTheme = localStorage.getItem('germanVerbsTheme') || 'auto';  // Motyw aplikacji        let incorrectVerbs = [];        // Sowa z bdnymi odpowiedziami
        let currentBlockId = null;      // ID aktualnego bloku
        let masteredBlocks = [];        // Lista opanowanych blok贸w
        let allBlockWords = [];         // Wszystkie sowa z aktualnego bloku - pena kopia
        let correctAnswersTracker = {}; // ledzenie poprawnych odpowiedzi dla ka偶dego sowa
        
        // Inicjalizacja lokalnego magazynu
        if (!localStorage.getItem('germanVerbsProgress')) {
            localStorage.setItem('germanVerbsProgress', JSON.stringify({}));
        } else {
            userProgress = JSON.parse(localStorage.getItem('germanVerbsProgress'));
        }
          // Wczytanie listy opanowanych blok贸w
        if (localStorage.getItem('germanVerbsMasteredBlocks')) {
            masteredBlocks = JSON.parse(localStorage.getItem('germanVerbsMasteredBlocks'));
        }
        
        // Wczytanie stanu licznik贸w poprawnych odpowiedzi
        if (localStorage.getItem('germanVerbsCorrectAnswersTracker')) {
            correctAnswersTracker = JSON.parse(localStorage.getItem('germanVerbsCorrectAnswersTracker'));
            console.log("Wczytano stan licznik贸w poprawnych odpowiedzi z localStorage");
        }

        // Ustawienie motywu
        function setTheme(theme) {
            if (theme === 'dark') {                document.documentElement.setAttribute('data-theme', 'dark');
            } else if (theme === 'light') {
                document.documentElement.setAttribute('data-theme', 'light');
            } else {
                document.documentElement.removeAttribute('data-theme');
            }
            
            localStorage.setItem('germanVerbsTheme', theme);
            userTheme = theme;
        }

        // Przeczenie motywu
        themeToggle.addEventListener('click', () => {
            if (userTheme === 'auto' || userTheme === 'light') {
                setTheme('dark');
            } else {
                setTheme('light');
            }
        });

        // Inicjalizacja motywu
        setTheme(userTheme);

        // Aktualizacja wygldu przycisk贸w blok贸w po zaadowaniu strony
        updateBlockButtons();

        // Sprawdzenie, czy samouczek zosta ju偶 ukoczony
        const tutorialCompleted = localStorage.getItem('germanVerbsTutorialComplete') === 'true';        // Obsuga samouczka
        startTutorialBtn.addEventListener('click', () => {
            console.log('Przycisk "Poka偶 samouczek" kliknity');
            console.log('Element tutorialOverlay przed otwarciem:', tutorialOverlay);
            tutorialOverlay.classList.remove('hidden');
            tutorialOverlay.style.display = 'flex';  // Explicite ustawiamy display na flex
            showTutorialStep(0);
        });

        tutorialPrevBtn.addEventListener('click', () => {
            console.log('Przycisk "Wstecz" kliknity');
            showTutorialStep(currentTutorialStep - 1);
        });
        
        tutorialNextBtn.addEventListener('click', () => {
            console.log('Przycisk "Dalej/Zakocz" kliknity');
            if (currentTutorialStep < tutorialSteps.length - 1) {
                showTutorialStep(currentTutorialStep + 1);
            } else {
                console.log('Osignito ostatni krok, zamykanie samouczka');
                closeTutorial();
            }
        });

        tutorialSkipBtn.addEventListener('click', () => {
            console.log('Przycisk "Pomi samouczek" kliknity');
            closeTutorial();
        });        function closeTutorial() {
            console.log('Zamykanie samouczka...');
            console.log('Element tutorialOverlay:', tutorialOverlay);
            console.log('Klasy przed zmian:', tutorialOverlay.className);
            
            // Bezporednie ustawienie stylu display
            tutorialOverlay.style.display = 'none';
            
            // Dodatkowo dodajemy klas hidden
            tutorialOverlay.classList.add('hidden');
            
            console.log('Klasy po zmianie:', tutorialOverlay.className);
            
            // Zapisanie informacji, 偶e samouczek zosta ukoczony
            localStorage.setItem('germanVerbsTutorialComplete', 'true');
            console.log('Samouczek zamknity i oznaczony jako ukoczony');
        }

        function showTutorialStep(stepIndex) {
            console.log('Pokazywanie kroku samouczka:', stepIndex);
            // Ukrywanie wszystkich krok贸w
            tutorialSteps.forEach(step => step.classList.add('hidden'));
            
            // Pokazanie wybranego kroku
            tutorialSteps[stepIndex].classList.remove('hidden');
            
            // Aktualizacja stanu przycisk贸w
            tutorialPrevBtn.disabled = stepIndex === 0;
            
            if (stepIndex === tutorialSteps.length - 1) {
                tutorialNextBtn.textContent = 'Zakocz';
            } else {
                tutorialNextBtn.textContent = 'Dalej';
            }
            
            currentTutorialStep = stepIndex;
            console.log('Aktualny krok samouczka ustawiony na:', currentTutorialStep);
        }

        // Dodanie obsugi kliknicia przycisku bloku
        document.querySelectorAll('.block-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const blockId = btn.getAttribute('data-block');
                console.log(`Kliknito przycisk bloku ${blockId}`);
                startLearningBlock(blockId);
            });
        });        // Funkcja rozpoczynajca nauk danego bloku
        function startLearningBlock(blockId) {
            console.log(`Rozpoczynam nauk bloku ${blockId}`);
            
            try {
                learningArea.classList.remove('hidden');
                startInfo.classList.add('hidden');
                
                // Zapisanie identyfikatora aktualnego bloku
                currentBlockId = blockId;
                
                // OCZYSZCZANIE: Usu sowa kt贸re ju偶 zostay opanowane (2/2) z licznika
                console.log("Oczyszczam opanowane sowa z licznika...");
                const masteredWords = [];
                for (const [word, count] of Object.entries(correctAnswersTracker)) {
                    if (count >= 2) {
                        masteredWords.push(word);
                    }
                }
                
                // Usu opanowane sowa z licznika
                masteredWords.forEach(word => {
                    delete correctAnswersTracker[word];
                    console.log(`Usunito opanowane sowo z licznika: ${word}`);
                });
                
                // Zapisz oczyszczony stan
                localStorage.setItem('germanVerbsCorrectAnswersTracker', JSON.stringify(correctAnswersTracker));
                
                // Czyszczenie listy niepoprawnych s贸w
                incorrectVerbs = [];
            
            // Przygotowanie listy czasownik贸w do nauki
            let selectedVerbs = [];
            
            if (blockId === 'all') {
                // W trybie "wszystkie" dodajemy tylko s贸wka z blok贸w, kt贸re nie s opanowane
                // lub wszystkie, jeli wszystkie bloki s ju偶 opanowane
                let anyBlockAdded = false;
                
                for (let i = 1; i <= 5; i++) {
                    if (!masteredBlocks.includes(i.toString())) {
                        selectedVerbs = selectedVerbs.concat(JSON.parse(JSON.stringify(verbBlocks[i])));
                        anyBlockAdded = true;
                    }
                }
                
                // Jeli wszystkie bloki s opanowane, dajemy wszystkie s贸wka
                if (!anyBlockAdded) {
                    for (let i = 1; i <= 5; i++) {
                        selectedVerbs = selectedVerbs.concat(JSON.parse(JSON.stringify(verbBlocks[i])));
                    }
                }
            } else {
                // Jeli blok zosta ju偶 opanowany, informujemy u偶ytkownika
                if (masteredBlocks.includes(blockId)) {
                    const confirmed = confirm(`Ten blok (${blockId}) zosta ju偶 przez Ciebie opanowany! Czy chcesz go powt贸rzy dla utrwalenia?`);
                    if (!confirmed) {
                        return; // Przerywamy funkcj, jeli u偶ytkownik nie chce powtarza
                    }
                }
                // Gbokie kopiowanie tablicy czasownik贸w z wybranego bloku
                selectedVerbs = JSON.parse(JSON.stringify(verbBlocks[blockId]));
            }
            
            // Zapisujemy pen kopi wszystkich s贸w z bloku do p贸藕niejszej weryfikacji
            allBlockWords = JSON.parse(JSON.stringify(selectedVerbs));
            console.log(`Blok ${blockId} zawiera ${allBlockWords.length} s贸w. Zapisano pen kopi dla weryfikacji.`);
            
            // Tasowanie czasownik贸w
            shuffleArray(selectedVerbs);
            currentVerbs = selectedVerbs;
            
            // Rozpoczcie nauki
            currentVerbIndex = 0;
            correctAnswers = 0;
            incorrectAnswers = 0;
            points = 0;
            updateStats();
            loadNextVerb();            
            // Aktualizacja listy sownictwa
            updateVocabularyList();
            
            // Aktualizacja wygldu przycisk贸w blok贸w
            updateBlockButtons();
            
            console.log(`Blok ${blockId} zosta zaadowany pomylnie`);
            } catch (error) {
                console.error(`Bd podczas adowania bloku ${blockId}:`, error);
                alert(`Wystpi bd podczas adowania bloku ${blockId}. Spr贸buj odwie偶y stron.`);
            }
        }
          // Funkcja adujca nastpny czasownik
        function loadNextVerb() {
            console.log(`loadNextVerb wywoane, indeks: ${currentVerbIndex}, liczba s贸w: ${currentVerbs.length}`);
            
            // Sprawdzamy, czy indeks nie wyszed poza zakres
            if (currentVerbIndex >= currentVerbs.length) {
                console.log("Indeks poza zakresem, przejcie do powt贸rki lub zakoczenia");
                
                // Sprawdzenie, czy mamy jeszcze s贸wka do powt贸rzenia
                if (incorrectVerbs.length > 0) {
                    console.log("Przed powt贸rk - liczba niepoprawnych s贸w:", incorrectVerbs.length);
                    
                    // Sprawd藕, czy mamy wszystkie sowa z bloku
                    // Jeli w procesie nauki, wszyscy czasowniki powinni by w puli powt贸rek
                    const totalExpectedWords = allBlockWords.length;
                    const missingWordsCount = totalExpectedWords - incorrectVerbs.length;
                    
                    if (missingWordsCount > 0) {
                        console.warn(`UWAGA: Brakuje ${missingWordsCount} s贸w w licie niepoprawnych! Powinno by ${totalExpectedWords}, jest ${incorrectVerbs.length}`);
                        
                        // Znajd藕 brakujce sowa
                        const incorrectVerbsInfinitives = incorrectVerbs.map(v => v.infinitive);
                        const missingWords = allBlockWords.filter(w => !incorrectVerbsInfinitives.includes(w.infinitive));
                        
                        if (missingWords.length > 0) {
                            console.warn("Brakujce sowa:", missingWords.map(w => `${w.polish} (${w.infinitive})`).join(", "));
                            
                            // Dodaj brakujce sowa do listy niepoprawnych
                            console.log("Dodaj brakujce sowa do listy niepoprawnych");
                            incorrectVerbs = incorrectVerbs.concat(JSON.parse(JSON.stringify(missingWords)));
                        }
                    }
                      // Walidacja listy niepoprawnych s贸w przed przygotowaniem powt贸rki
                    validateIncorrectVerbs();
                    
                    // NIE resetujemy trackera poprawnych odpowiedzi przed powt贸rk!
                    // Zamiast tego, dodajmy logowanie, by zobaczy stan licznik贸w
                    console.log("Stan licznik贸w correctAnswersTracker przed powt贸rk:");
                    for (const [word, count] of Object.entries(correctAnswersTracker)) {
                        console.log(`- ${word}: ${count}/2`);
                    }
                    
                    // Zapisujemy liczb s贸w przed kopiowaniem (dla debugowania)
                    const incorrectVerbsCount = incorrectVerbs.length;
                    
                    // Gbokie kopiowanie listy niepoprawnych s贸w
                    console.log("Lista niepoprawnych s贸w przed kopiowaniem:");
                    incorrectVerbs.forEach((verb, idx) => {
                        console.log(`${idx + 1}. ${verb.polish} (${verb.infinitive})`);
                    });
                    
                    // Utw贸rz poprawn gbok kopi tablicy niepoprawnych czasownik贸w
                    const incorrectVerbsDeepCopy = JSON.parse(JSON.stringify(incorrectVerbs));
                    
                    // Przypisujemy gbok kopi do currentVerbs
                    currentVerbs = incorrectVerbsDeepCopy;
                    // WA呕NA ZMIANA: NIE CZYCIMY LISTY NIEPOPRAWNYCH SW
                    // Niepoprawne sowa zostan usunite z listy tylko wtedy, gdy bd 2 razy odpowiedziane poprawnie
                    // incorrectVerbs = []; // To usunito - NIE czycimy tablicy niepoprawnych
                    
                    shuffleArray(currentVerbs); // Mieszamy s贸wka
                    currentVerbIndex = 0;
                    
                    console.log("Lista s贸w przygotowanych do powt贸rki:", currentVerbs.map(v => v.polish).join(", "));
                    console.log(`Liczba s贸w do powt贸rki: ${currentVerbs.length} (powinno by: ${incorrectVerbsCount})`);
                    
                    // Sprawd藕, czy liczba s贸w si zgadza
                    if (currentVerbs.length !== incorrectVerbsCount) {
                        console.error("BD: Liczba s贸w do powt贸rki nie zgadza si z liczb niepoprawnych s贸w!");
                        console.error("Brakujce sowa:", 
                            incorrectVerbsDeepCopy.filter(v1 => !currentVerbs.some(v2 => v2.infinitive === v1.infinitive))
                                .map(v => v.polish).join(", ")
                        );
                    }
                    
                    console.log("Po przygotowaniu do powt贸rki - liczba s贸w:", currentVerbs.length);                    // Informujemy u偶ytkownika o powt贸rce
                    polishWord.textContent = 'Powt贸rka!';
                    resultDisplay.innerHTML = `<div class="hint">Powt贸rzymy ${currentVerbs.length} s贸wek, kt贸re wymagaj wicej wicze.</div>
                    <div>Ka偶de s贸wko musi zosta poprawnie odpowiedziane <strong>2 razy z rzdu</strong> (wszystkie 3 formy), aby zostao uznane za opanowane.</div>
                    <div>Ka偶da bdna odpowied藕 resetuje licznik do zera. System adaptacyjny zapamituje Twoje bdy i skupia si na sowach, kt贸re sprawiaj Ci trudno.</div>`;
                    resultDisplay.className = 'result';
                    checkBtn.classList.add('hidden');
                    
                    // Dodajemy przycisk do kontynuacji
                    nextBtn.textContent = 'Kontynuuj powt贸rk';
                    nextBtn.classList.remove('hidden');
                    
                    // Po klikniciu przycisku rozpoczynamy powt贸rk
                    nextBtn.onclick = function() {
                        nextBtn.textContent = 'Nastpne sowo'; // Przywracamy oryginalny tekst
                        nextBtn.onclick = null; // Usuwamy ten handler
                        loadNextVerb(); // adujemy pierwszy czasownik z powt贸rki
                    };
                    
                    // Aktualizacja statystyk
                    updateProgressBar();
                    
                    // Wywietl szczeg贸owe informacje o powt贸rce
                    console.log("====== ROZPOCZYNAM POWTRK ======");
                    console.log("Liczba s贸w do powt贸rki:", currentVerbs.length);
                    console.log("Sowa do powt贸rki:", currentVerbs.map(v => v.polish).join(", "));
                    console.log("Lista niepoprawnych:", incorrectVerbs.map(v => v.polish).join(", "));
                    console.log("Liczba niepoprawnych:", incorrectVerbs.length);
                    console.log("=================================");
                } else {
                    // Koniec nauki - wszystkie s贸wka opanowane
                    handleLearningComplete();
                }            } else {
                // Normalny przypadek - wywietlanie nastpnego sowa
                // SPRAWD殴 czy aktualne sowo nie zostao ju偶 opanowane (>=2 poprawne odpowiedzi)
                let attempts = 0;
                while (currentVerbIndex < currentVerbs.length && attempts < currentVerbs.length) {
                    const potentialVerb = currentVerbs[currentVerbIndex];
                    const verbCount = correctAnswersTracker[potentialVerb.infinitive] || 0;
                    
                    if (verbCount >= 2) {
                        console.log(`Pomijam opanowane sowo: "${potentialVerb.polish}" (${verbCount}/2)`);
                        // Usu opanowane sowo z currentVerbs
                        currentVerbs.splice(currentVerbIndex, 1);
                        // Nie zwikszamy indeksu, bo nastpny element przesun si na t pozycj
                        attempts++;
                        continue;
                    } else {
                        // Znale藕limy sowo kt贸re nie jest jeszcze opanowane
                        break;
                    }
                }
                
                // Sprawd藕 ponownie czy mamy jeszcze sowa po filtrowaniu
                if (currentVerbIndex >= currentVerbs.length) {
                    console.log("Po usuniciu opanowanych s贸w, nie ma wicej s贸w do nauki");
                    loadNextVerb(); // Rekurencyjne wywoanie, kt贸re przejdzie do logiki zakoczenia
                    return;
                }
                
                currentVerb = currentVerbs[currentVerbIndex];
                console.log(`Wywietlam sowo: "${currentVerb.polish}" (licznik: ${correctAnswersTracker[currentVerb.infinitive] || 0}/2)`);
                polishWord.textContent = currentVerb.polish;
                
                // Czyszczenie p贸l wejciowych
                infinitiveInput.value = '';
                preteriteInput.value = '';
                perfectInput.value = '';
                
                // Resetowanie kolor贸w p贸l
                infinitiveInput.style.backgroundColor = '';
                infinitiveInput.style.color = '';
                infinitiveInput.style.border = '';
                preteriteInput.style.backgroundColor = '';
                preteriteInput.style.color = '';
                preteriteInput.style.border = '';
                perfectInput.style.backgroundColor = '';
                perfectInput.style.color = '';
                perfectInput.style.border = '';
                
                // Resetowanie stanu UI
                resultDisplay.textContent = '';
                resultDisplay.className = 'result';
                feedbackDisplay.classList.add('hidden');
                feedbackDisplay.textContent = '';
                checkBtn.classList.remove('hidden');
                nextBtn.classList.add('hidden');
                
                // Aktualizacja statystyk
                remainingDisplay.textContent = currentVerbs.length - currentVerbIndex;
                updateProgressBar();
                  // Ustawienie fokusu na pierwsze pole
                infinitiveInput.focus();
            }
        }
          // Funkcja obsugujca zakoczenie nauki
        function handleLearningComplete() {
            // Sprawd藕, czy lista niepoprawnych s贸w jest pusta
            // Jeli nie jest pusta, to nie powinnimy koczy nauki
            if (incorrectVerbs.length > 0) {
                console.warn("UWAGA: handleLearningComplete zosta wywoany, ale lista niepoprawnych s贸w nie jest pusta!");
                console.warn("Liczba niepoprawnych s贸w:", incorrectVerbs.length);
                console.warn("Niepoprawne sowa:", incorrectVerbs.map(v => v.polish).join(", "));
                
                // Zamiast koczy nauk, rozpoczynamy powt贸rk
                console.log("Przekierowuj do powt贸rki zamiast koczy nauk...");
                
                // Ustawiamy bie偶cy indeks poza zakresem, 偶eby loadNextVerb przeszed do powt贸rki
                currentVerbIndex = currentVerbs.length;
                loadNextVerb();
                return;
            }
            
            // Jeli to by konkretny blok (nie "all"), oznaczamy go jako opanowany
            if (currentBlockId !== 'all' && !masteredBlocks.includes(currentBlockId)) {
                masteredBlocks.push(currentBlockId);
                localStorage.setItem('germanVerbsMasteredBlocks', JSON.stringify(masteredBlocks));
                
                // Okrelenie nastpnego bloku do nauki
                const nextBlockId = getNextBlockId(currentBlockId);
                
                polishWord.textContent = 'Gratulacje! ';
                resultDisplay.innerHTML = `<p class="correct">wietnie! Opanowae/a wszystkie czasowniki z bloku ${currentBlockId}!</p>
                <p>Tw贸j wynik: ${points} punkt贸w.</p>
                <p>Blok zosta oznaczony jako opanowany i zapisany w Twoim profilu.</p>`;
                
                if (nextBlockId) {
                    resultDisplay.innerHTML += `<p>Czy chcesz przej do nastpnego bloku?</p>
                        <button id="next-block-btn" class="tutorial-nav-btn">Tak, przejd藕 do bloku ${nextBlockId}</button>
                        <button id="stay-btn" class="tutorial-nav-btn tutorial-skip">Nie, zosta tutaj</button>`;
                    
                    // Dodanie obsugi przycisk贸w
                    document.getElementById('next-block-btn').addEventListener('click', () => {
                        startLearningBlock(nextBlockId);
                    });
                    
                    document.getElementById('stay-btn').addEventListener('click', () => {
                        // Nic nie robimy, u偶ytkownik zostaje na obecnym ekranie
                    });
                } else {
                    resultDisplay.innerHTML += `<p class="correct">Brawo! Opanowae/a wszystkie bloki czasownik贸w!</p>
                    <p>Mo偶esz teraz powt贸rzy dowolny blok dla utrwalenia wiedzy lub wybra opcj "Wszystkie" aby przewiczy wszystkie czasowniki razem.</p>`;
                }
            } else if (currentBlockId === 'all') {
                // Komunikat dla trybu "wszystkie"
                polishWord.textContent = 'Ukoczono! ';
                resultDisplay.innerHTML = `<p class="correct">Gratulacje! Poprawnie odpowiedziae/a na wszystkie pytania w trybie "Wszystkie".</p>
                <p>Tw贸j wynik: ${points} punkt贸w.</p>
                <p>Mo偶esz teraz wybra inny blok do nauki lub powt贸rzy ten sam tryb.</p>`;
            } else {
                // Komunikat dla ju偶 opanowanego bloku
                polishWord.textContent = 'Powt贸rka ukoczona! ';
                resultDisplay.innerHTML = `<p class="correct">wietnie! Powt贸rzye/a blok ${currentBlockId}, kt贸ry wczeniej ju偶 opanowae/a.</p>
                <p>Tw贸j wynik: ${points} punkt贸w.</p>
                <p>Regularnie powtarzaj materia, aby go nie zapomnie!</p>`;
                
                // Okrelenie nastpnego bloku do nauki
                const nextBlockId = getNextBlockId(currentBlockId);
                
                if (nextBlockId) {
                    resultDisplay.innerHTML += `<p>Czy chcesz przej do bloku ${nextBlockId}?</p>
                        <button id="next-block-btn" class="tutorial-nav-btn">Tak, przejd藕 do bloku ${nextBlockId}</button>
                        <button id="stay-btn" class="tutorial-nav-btn tutorial-skip">Nie, zosta tutaj</button>`;
                    
                    // Dodanie obsugi przycisk贸w
                    document.getElementById('next-block-btn').addEventListener('click', () => {
                        startLearningBlock(nextBlockId);
                    });
                    
                    document.getElementById('stay-btn').addEventListener('click', () => {
                        // Nic nie robimy, u偶ytkownik zostaje na obecnym ekranie
                    });
                }
            }
            
            resultDisplay.className = 'result';
            checkBtn.classList.add('hidden');
            nextBtn.classList.add('hidden');
            
            // Aktualizacja statystyk
            remainingDisplay.textContent = '0';
            updateProgressBar(100); // Ustawienie paska postpu na 100%
        }
        
        // Funkcja zwracajca ID nastpnego bloku do nauki
        function getNextBlockId(currentBlockId) {
            const blockNumber = parseInt(currentBlockId);
            
            if (isNaN(blockNumber) || blockNumber >= 5) {
                return null; // Nie ma nastpnego bloku
            }
            
            const nextBlockId = (blockNumber + 1).toString();
            
            // Sprawdzamy, czy nastpny blok nie zosta ju偶 opanowany
            if (masteredBlocks.includes(nextBlockId)) {
                return getNextBlockId(nextBlockId); // Rekurencyjnie szukamy kolejnego nieopanowanego bloku
            }
            
            return nextBlockId;
        }        // Funkcja sprawdzajca odpowiedzi
        function checkAnswers() {
            console.log("=== FUNKCJA checkAnswers ZOSTAA WYWOANA ===");
            console.log("Funkcja checkAnswers wywoana");
            
            const userInfinitive = infinitiveInput.value.trim().toLowerCase();
            const userPreterite = preteriteInput.value.trim().toLowerCase();
            const userPerfect = perfectInput.value.trim().toLowerCase();
            
            console.log(`Sprawdzam odpowiedzi: "${userInfinitive}", "${userPreterite}", "${userPerfect}"`);
            console.log(`Poprawne odpowiedzi: "${currentVerb.infinitive}", "${currentVerb.preterite}", "${currentVerb.perfect}"`);            console.log("=== DEBUGOWANIE checkAnswers ===");
            console.log("SPRAWDZAM: Czy pola s puste...");
            const areFieldsEmpty = highlightEmptyFields();
            console.log("Wynik sprawdzenia pustych p贸l:", areFieldsEmpty);
            
            if (areFieldsEmpty) {
                console.log("POLA S PUSTE - pokazuj poprawne odpowiedzi");
                resultDisplay.textContent = 'Pokazuj poprawne odpowiedzi. Postaraj si je zapamita!';
                resultDisplay.className = 'result';
                
                // Wypenij pola poprawnymi odpowiedziami
                infinitiveInput.value = currentVerb.infinitive;
                infinitiveInput.style.backgroundColor = 'var(--correct-color)';
                infinitiveInput.style.color = 'white';
                
                preteriteInput.value = currentVerb.preterite;
                preteriteInput.style.backgroundColor = 'var(--correct-color)';
                preteriteInput.style.color = 'white';
                
                perfectInput.value = currentVerb.perfect;
                perfectInput.style.backgroundColor = 'var(--correct-color)';
                perfectInput.style.color = 'white';
                
                // Poka偶 informacj w obszarze feedbacku
                let feedback = `
                    <div>Bezokolicznik: <span class="correct">${currentVerb.infinitive}</span></div>
                    <div>Pr盲teritum: <span class="correct">${currentVerb.preterite}</span></div>
                    <div>Perfekt: <span class="correct">${currentVerb.perfect}</span></div>
                `;
                
                // Dodanie przykadowego zdania
                let exampleSentence = '';
                switch (currentVerb.infinitive) {
                    case 'gehen':
                        exampleSentence = 'Przykad: Ich <strong>gehe</strong> zur Schule. (Id do szkoy)';
                        break;
                    case 'essen':
                        exampleSentence = 'Przykad: Ich <strong>esse</strong> einen Apfel. (Jem jabko)';
                        break;
                    case 'trinken':
                        exampleSentence = 'Przykad: Er <strong>trinkt</strong> Wasser. (On pije wod)';
                        break;
                    case 'lesen':
                        exampleSentence = 'Przykad: Sie <strong>liest</strong> ein Buch. (Ona czyta ksi偶k)';
                        break;
                    case 'schreiben':
                        exampleSentence = 'Przykad: Wir <strong>schreiben</strong> einen Brief. (Piszemy list)';
                        break;
                    default:
                        // Dla innych czasownik贸w - generowanie prostego przykadu
                        exampleSentence = `Przykad: Ich <strong>${currentVerb.infinitive}</strong>. (Ja ${currentVerb.polish})`;
                }
                
                feedback += `<div class="example-sentence">${exampleSentence}</div>`;
                
                feedbackDisplay.innerHTML = `<div class="hint">Poprawne odpowiedzi:</div>${feedback}`;
                feedbackDisplay.classList.remove('hidden');
                
                // Ukryj przycisk sprawd藕 i poka偶 przycisk nastpny
                checkBtn.classList.add('hidden');
                nextBtn.classList.remove('hidden');
                
                // Dodaj s贸wko do listy niepoprawnych
                addToIncorrectVerbs();
                
                // Resetuj licznik poprawnych odpowiedzi dla tego sowa - puste pola to te偶 bd                
                if (currentVerb && currentVerb.infinitive) {
                    const oldCount = correctAnswersTracker[currentVerb.infinitive] || 0;
                    correctAnswersTracker[currentVerb.infinitive] = 0;
                    console.log(`DEBUG: RESETUJ LICZNIK (puste pola) - poprzedni stan: ${oldCount}, nowy stan: 0`);
                    console.log(`Resetuj licznik poprawnych odpowiedzi dla "${currentVerb.polish}" - puste pola`);
                    
                    // Zapisz stan licznik贸w do localStorage po resecie
                    localStorage.setItem('germanVerbsCorrectAnswersTracker', JSON.stringify(correctAnswersTracker));
                }
                
                // Zaktualizuj statystyki
                incorrectAnswers++;
                updateStats();
                  return; // Przerywamy funkcj - nic wicej nie sprawdzamy
            }
            
            console.log("KONTYNUUJ - pola nie s puste");
            let correctCount = 0;
            let feedback = '';
            
            console.log("SPRAWDZAM odpowiedzi...");
            // Sprawdzanie bezokolicznika
            console.log(`Por贸wnuj bezokolicznik: "${userInfinitive}" === "${currentVerb.infinitive}"`);
            if (userInfinitive === currentVerb.infinitive) {
                correctCount++;
                console.log("Bezokolicznik POPRAWNY");
                infinitiveInput.style.backgroundColor = 'var(--correct-color)';
                infinitiveInput.style.color = 'white';
            } else {
                console.log("Bezokolicznik NIEPOPRAWNY");
                infinitiveInput.style.backgroundColor = 'var(--incorrect-color)';
                infinitiveInput.style.color = 'white';
                feedback += `<div>Bezokolicznik: <span class="correct">${currentVerb.infinitive}</span></div>`;
            }
              // Sprawdzanie Pr盲teritum
            console.log(`Por贸wnuj Pr盲teritum: "${userPreterite}" === "${currentVerb.preterite}"`);
            if (userPreterite === currentVerb.preterite) {
                correctCount++;
                console.log("Pr盲teritum POPRAWNY");
                preteriteInput.style.backgroundColor = 'var(--correct-color)';
                preteriteInput.style.color = 'white';
            } else {
                console.log("Pr盲teritum NIEPOPRAWNY");
                preteriteInput.style.backgroundColor = 'var(--incorrect-color)';
                preteriteInput.style.color = 'white';
                feedback += `<div>Pr盲teritum: <span class="correct">${currentVerb.preterite}</span></div>`;
            }
            
            // Sprawdzanie Perfekt
            console.log(`Por贸wnuj Perfekt: "${userPerfect}" === "${currentVerb.perfect}"`);
            if (userPerfect === currentVerb.perfect) {
                correctCount++;
                console.log("Perfekt POPRAWNY");
                perfectInput.style.backgroundColor = 'var(--correct-color)';                perfectInput.style.color = 'white';
            } else {
                console.log("Perfekt NIEPOPRAWNY");
                perfectInput.style.backgroundColor = 'var(--incorrect-color)';
                perfectInput.style.color = 'white';
                feedback += `<div>Perfekt: <span class="correct">${currentVerb.perfect}</span></div>`;
            }
            
            console.log(`WYNIK SPRAWDZENIA: ${correctCount}/3 poprawne odpowiedzi`);            console.log(`WYNIK SPRAWDZENIA: ${correctCount}/3 poprawne odpowiedzi`);
              
            // Punktacja
            const newPoints = correctCount * correctCount; // 0, 1, 4 lub 9 punkt贸w
            console.log(`Dodaj ${newPoints} punkt贸w`);
            points += newPoints;            // Wywietlanie wyniku
            console.log("SPRAWDZAM czy wszystkie odpowiedzi s poprawne...");
            if (correctCount === 3) {
                console.log("WSZYSTKIE 3 ODPOWIEDZI S POPRAWNE!");
                resultDisplay.textContent = 'Wszystko poprawnie! +9 punkt贸w';
                resultDisplay.className = 'result correct';
                correctAnswers++;
                
                // Sprawd藕 aktualny stan licznika PRZED sprawdzeniem i ewentualnym usuniciem
                const currentCount = correctAnswersTracker[currentVerb.infinitive] || 0;
                
                // Usuwamy poprawnie odpowiedziane s贸wko z puli TYLKO jeli wszystkie odpowiedzi s poprawne i to dokadnie drugi raz
                const wasRemoved = checkAndRemoveWord(correctCount);
                  
                // Wypisz stan aplikacji do konsoli (debugowanie)                
                if (wasRemoved) {
                    console.log("Wszystkie odpowiedzi poprawne 2/2 razy - usuwam s贸wko z puli!");
                    resultDisplay.textContent = 'Wszystko poprawnie! +9 punkt贸w. Opanowae to sowo! (2/2)';
                } else {
                    // U偶ywamy zaktualizowanego licznika z checkAndRemoveWord
                    const newCount = correctAnswersTracker[currentVerb.infinitive] || 0;
                    console.log(`Wszystkie odpowiedzi poprawne ${newCount}/2 razy - s贸wko pozostaje w puli`);
                    if (newCount === 1) {
                        resultDisplay.textContent = 'Wszystko poprawnie! +9 punkt贸w. Jeszcze raz poprawnie i opanujesz to sowo! (1/2)';
                    } else {
                        resultDisplay.textContent = 'Wszystko poprawnie! +9 punkt贸w';
                    }
                }
                logAppState();
            } else {
                // Wszystkie inne przypadki (1-2 poprawne lub wszystkie bdne)
                if (correctCount > 0) {
                    resultDisplay.textContent = `Czciowo poprawnie. +${newPoints} punkt贸w`;
                    resultDisplay.className = 'result';
                    
                    if (correctCount >= 2) {
                        correctAnswers++;
                    } else {
                        incorrectAnswers++;
                    }
                } else {
                    resultDisplay.textContent = 'Niestety, wszystkie odpowiedzi s niepoprawne.';
                    resultDisplay.className = 'result incorrect';
                    incorrectAnswers++;
                }
                  // Dodanie czasownika do listy niepoprawnych, gdy nie wszystkie odpowiedzi s poprawne
                addToIncorrectVerbs();
                  // Resetuj licznik poprawnych odpowiedzi dla tego sowa przy bdzie
                if (currentVerb && currentVerb.infinitive) {                    const oldCount = correctAnswersTracker[currentVerb.infinitive] || 0;
                    correctAnswersTracker[currentVerb.infinitive] = 0;
                    console.log(`DEBUG: RESETUJ LICZNIK - poprzedni stan: ${oldCount}, nowy stan: 0`);
                    console.log(`Resetuj licznik poprawnych odpowiedzi dla "${currentVerb.polish}" - niepoprawna odpowied藕`);
                    
                    // Zapisz stan licznik贸w do localStorage po resecie
                    localStorage.setItem('germanVerbsCorrectAnswersTracker', JSON.stringify(correctAnswersTracker));
                }
                
                // Wypisz stan aplikacji do konsoli (debugowanie)
                console.log(`Odpowiedzi czciowo poprawne (${correctCount}/3) - dodaj sowo do niepoprawnych`);
                logAppState();
            }
            
            // Dodanie przykadowego zdania jako wskaz贸wka
            let exampleSentence = '';
            if (correctCount < 3) {
                switch (currentVerb.infinitive) {
                    case 'gehen':
                        exampleSentence = 'Przykad: Ich <strong>gehe</strong> zur Schule. (Id do szkoy)';
                        break;
                    case 'essen':
                        exampleSentence = 'Przykad: Ich <strong>esse</strong> einen Apfel. (Jem jabko)';
                        break;
                    case 'trinken':
                        exampleSentence = 'Przykad: Er <strong>trinkt</strong> Wasser. (On pije wod)';
                        break;
                    case 'lesen':
                        exampleSentence = 'Przykad: Sie <strong>liest</strong> ein Buch. (Ona czyta ksi偶k)';
                        break;
                    case 'schreiben':
                        exampleSentence = 'Przykad: Wir <strong>schreiben</strong> einen Brief. (Piszemy list)';
                        break;
                    default:
                        // Dla innych czasownik贸w - generowanie prostego przykadu
                        exampleSentence = `Przykad: Ich <strong>${currentVerb.infinitive}</strong>. (Ja ${currentVerb.polish})`;
                }
                
                if (feedback) {
                    feedback += `<div class="example-sentence">${exampleSentence}</div>`;
                }
            }
              // Aktualizacja interfejsu
            if (feedback) {
                feedbackDisplay.innerHTML = `<div class="hint">Poprawne odpowiedzi:</div>${feedback}`;
                feedbackDisplay.classList.remove('hidden');
            } else {
                // Ukryj feedback jeli nie ma bd贸w
                feedbackDisplay.classList.add('hidden');
            }
            
            // ZAWSZE ukrywamy przycisk sprawd藕 i pokazujemy przycisk nastpny
            checkBtn.classList.add('hidden');
            nextBtn.classList.remove('hidden');
            
            // Aktualizacja statystyk
            updateStats();
              // Zaktualizuj liczb pozostaych s贸wek
            remainingDisplay.textContent = currentVerbs.length - currentVerbIndex - 1;
            
            // Zapisanie postpu
            saveProgress(currentVerb.infinitive, correctCount);
        }
          // Pomocnicza funkcja do dodawania czasownika do listy niepoprawnych
        function addToIncorrectVerbs() {
            if (!currentVerb) {
                console.error("Pr贸ba dodania null do niepoprawnych czasownik贸w!");
                return;
            }
            
            // SPRAWD殴 NAJPIERW czy to sowo nie zostao ju偶 opanowane (2/2)
            const verbId = currentVerb.infinitive;
            const currentCount = correctAnswersTracker[verbId] || 0;
            
            if (currentCount >= 2) {
                console.log(`UWAGA: Sowo "${currentVerb.polish}" ma ju偶 ${currentCount}/2 i nie powinno by dodawane do niepoprawnych!`);
                return; // Nie dodajemy s贸w kt贸re ju偶 zostay opanowane
            }
            
            // Tworzymy kopi obiektu u偶ywajc JSON.parse + JSON.stringify dla gbokiego kopiowania
            const verbCopy = JSON.parse(JSON.stringify(currentVerb));
            
            // Dodajemy dodatkowe debugowanie
            console.log(`SPRAWDZANIE: addToIncorrectVerbs dla sowa "${verbCopy.polish}" (${verbCopy.infinitive})`);
            console.log(`Aktualny indeks: ${currentVerbIndex}, dugo puli: ${currentVerbs.length}`);
            
            // Sprawdzamy, czy czasownik nie jest ju偶 w licie
            const isDuplicate = incorrectVerbs.some(verb => verb.infinitive === verbCopy.infinitive);
            
            // Resetujemy licznik poprawnych odpowiedzi dla tego sowa TYLKO jeli nie jest ju偶 opanowane
            if (verbCopy.infinitive && currentCount < 2) {
                correctAnswersTracker[verbCopy.infinitive] = 0;
                console.log(`Zresetowano licznik poprawnych odpowiedzi dla "${verbCopy.polish}" (${verbCopy.infinitive})`);
            }
            
            if (!isDuplicate) {
                // Upewniamy si, 偶e wszystkie wymagane pola s obecne
                if (verbCopy.infinitive && verbCopy.preterite && verbCopy.perfect && verbCopy.polish) {
                    incorrectVerbs.push(verbCopy);
                    console.log(`Dodano "${verbCopy.polish}" (${verbCopy.infinitive}) do niepoprawnych. Aktualna liczba: ${incorrectVerbs.length}`);
                    console.log(`Pena lista niepoprawnych: ${incorrectVerbs.map(v => v.polish).join(', ')}`);
                } else {
                    console.error("BD: Pr贸ba dodania niepoprawnego obiektu czasownika:", verbCopy);
                }
                
                // Sprawd藕, czy lista jest poprawna
                validateIncorrectVerbs();
            } else {
                console.log(`Sowo "${verbCopy.polish}" (${verbCopy.infinitive}) ju偶 jest na licie niepoprawnych.`);
            }
        }
        // Funkcja zapisujca postp nauki
        function saveProgress(verbInfinitive, correctCount) {
            if (!userProgress[verbInfinitive]) {
                userProgress[verbInfinitive] = { attempts: 0, correctForms: 0 };
            }
            
            userProgress[verbInfinitive].attempts++;
            userProgress[verbInfinitive].correctForms += correctCount;
            
            localStorage.setItem('germanVerbsProgress', JSON.stringify(userProgress));
        }

        // Funkcja aktualizujca statystyki
        function updateStats() {
            pointsDisplay.textContent = points;
            correctDisplay.textContent = correctAnswers;
            incorrectDisplay.textContent = incorrectAnswers;
        }

        // Funkcja aktualizujca pasek postpu
        function updateProgressBar(overrideValue = null) {
            let progress;
            if (overrideValue !== null) {
                progress = overrideValue;
            } else if (currentVerbs.length === 0) {
                progress = 100; // Unikamy dzielenia przez zero
            } else {
                progress = (currentVerbIndex / currentVerbs.length) * 100;
            }
            progressBar.style.width = `${progress}%`;
        }

        // Funkcja aktualizujca list sownictwa
        function updateVocabularyList() {
            vocabularyList.innerHTML = '';
            
            currentVerbs.forEach(verb => {
                const item = document.createElement('div');
                item.className = 'vocabulary-item';
                item.textContent = `${verb.polish}  ${verb.infinitive}, ${verb.preterite}, ${verb.perfect}`;
                vocabularyList.appendChild(item);
            });
        }

        // Funkcja do aktualizacji wygldu przycisk贸w blok贸w
        function updateBlockButtons() {
            document.querySelectorAll('.block-btn').forEach(btn => {
                const blockId = btn.getAttribute('data-block');
                if (blockId !== 'all' && masteredBlocks.includes(blockId)) {
                    btn.style.opacity = '0.7';
                    btn.style.position = 'relative';
                    
                    // Sprawdzamy, czy ju偶 istnieje badge
                    let badge = btn.querySelector('.mastered-badge');
                    if (!badge) {
                        badge = document.createElement('span');
                        badge.className = 'mastered-badge';
                        badge.style.position = 'absolute';
                        badge.style.top = '-8px';
                        badge.style.right = '-8px';
                        badge.style.backgroundColor = 'var(--correct-color)';
                        badge.style.color = 'white';
                        badge.style.borderRadius = '50%';
                        badge.style.width = '20px';
                        badge.style.height = '20px';
                        badge.style.display = 'flex';
                        badge.style.alignItems = 'center';
                        badge.style.justifyContent = 'center';
                        badge.style.fontSize = '14px';
                        badge.style.fontWeight = 'bold';
                        badge.innerHTML = '';
                        btn.appendChild(badge);
                    }
                } else {
                    btn.style.opacity = '1';
                    const badge = btn.querySelector('.mastered-badge');                    if (badge) {
                        btn.removeChild(badge);
                    }
                }
            });
        }        // Obsuga przycisku sprawdzania
        console.log("Dodaj event listener do przycisku sprawd藕:", checkBtn);
        if (checkBtn) {
            checkBtn.addEventListener('click', function(event) {
                console.log("Kliknito przycisk sprawd藕!", event);
                event.preventDefault(); // Zapobiegamy domylnej akcji
                checkAnswers();
            });
        } else {
            console.error("BD: Nie mo偶na znale藕 przycisku sprawd藕!");
        }
          // Obsuga przycisku nastpnego sowa
        nextBtn.addEventListener('click', () => {
            console.log("Kliknito przycisk 'Nastpne sowo'");
            
            // Resetowanie kolor贸w p贸l
            infinitiveInput.style.backgroundColor = '';
            infinitiveInput.style.color = '';
            preteriteInput.style.backgroundColor = '';
            preteriteInput.style.color = '';
            perfectInput.style.backgroundColor = '';
            perfectInput.style.color = '';
            
            // Ukrycie feedbacku
            feedbackDisplay.classList.add('hidden');
            
            // Sprawdzamy, czy aktualny indeks jest w zakresie
            if (currentVerbIndex < currentVerbs.length - 1) {
                // Jeli nie jestemy na ostatnim sowie, po prostu zwikszamy indeks
                currentVerbIndex++;
            } else {
                // Jeli jestemy na ostatnim sowie, ustawiamy indeks poza zakresem,
                // co spowoduje przejcie do logiki powt贸rki lub zakoczenia nauki
                currentVerbIndex = currentVerbs.length;
            }
              // Wypisz stan aplikacji do konsoli (debugowanie)
            console.log(`Przechodz do nastpnego sowa, nowy indeks: ${currentVerbIndex}`);
            logAppState();
            loadNextVerb();
        });
        
        // Obsuga klawisza Enter
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                if (!checkBtn.classList.contains('hidden')) {
                    checkAnswers();
                } else if (!nextBtn.classList.contains('hidden')) {
                    // U偶ywamy takiej samej logiki jak w przycisku "Nastpne sowo"
                    if (currentVerbIndex < currentVerbs.length - 1) {
                        currentVerbIndex++;
                    } else {
                        currentVerbIndex = currentVerbs.length;
                    }
                    loadNextVerb();
                }
            }
        });

        // Obsuga przecznika listy sownictwa
        vocabularyToggle.addEventListener('click', () => {
            vocabularyList.classList.toggle('show');
            vocabularyToggle.textContent = vocabularyList.classList.contains('show') ? 'Ukryj sownictwo' : 'Poka偶 sownictwo';
        });

        // Funkcja do tasowania tablicy (algorytm Fisher-Yates)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Funkcja podwietlajca puste pola
        function highlightEmptyFields() {
            const infinitiveEmpty = infinitiveInput.value.trim() === '';
            const preteriteEmpty = preteriteInput.value.trim() === '';
            const perfectEmpty = perfectInput.value.trim() === '';
            
            // Resetowanie styl贸w
            infinitiveInput.style.border = '';
            preteriteInput.style.border = '';
            perfectInput.style.border = '';
            
            // Podwietlanie pustych p贸l
            if (infinitiveEmpty) {
                infinitiveInput.style.border = '2px solid var(--incorrect-color)';
            }
            
            if (preteriteEmpty) {
                preteriteInput.style.border = '2px solid var(--incorrect-color)';
            }
            
            if (perfectEmpty) {
                perfectInput.style.border = '2px solid var(--incorrect-color)';
            }
            
            return infinitiveEmpty || preteriteEmpty || perfectEmpty;
        }
        // Pomocnicza funkcja sprawdzajca, czy wszystkie odpowiedzi s poprawne i usuwajca sowo z puli
        // Ka偶de sowo musi by odpowiedziane poprawnie 2 razy zanim zostanie usunite z puli
          function checkAndRemoveWord(correctCount) {
            console.log(`DEBUG: Wywoanie checkAndRemoveWord z correctCount=${correctCount}`);
            if (correctCount === 3) {
                // ledzenie, ile razy sowo zostao odpowiedziane poprawnie
                const verbId = currentVerb.infinitive;
                const oldCount = correctAnswersTracker[verbId] || 0;
                correctAnswersTracker[verbId] = oldCount + 1;
                  console.log(`DEBUG: Sowo "${currentVerb.polish}" (${verbId}) - poprzedni licznik: ${oldCount}, nowy licznik: ${correctAnswersTracker[verbId]}/2 wymaganych`);
                console.log(`Sowo "${currentVerb.polish}" odpowiedziane poprawnie ${correctAnswersTracker[verbId]}/2 razy`);
                
                // Zapisz stan licznik贸w do localStorage
                localStorage.setItem('germanVerbsCorrectAnswersTracker', JSON.stringify(correctAnswersTracker));
                
                // Wypisz wszystkie ledzenia s贸w
                console.log("DEBUG: Stan licznik贸w correctAnswersTracker:");
                for (const [word, count] of Object.entries(correctAnswersTracker)) {
                    console.log(`- ${word}: ${count}/2`);
                }
                
                // Usuwamy sowo TYLKO jeli zostao odpowiedziane poprawnie 2 razy (nie usuwa po pierwszym razie)
                const totalCorrectAnswers = userProgress[verbId]?.correctForms || 0;
                console.log(`DEBUG: Cakowita liczba poprawnych odpowiedzi dla "${currentVerb.polish}": ${totalCorrectAnswers}`);                // Usuwamy sowo TYLKO gdy zostao odpowiedziane dokadnie 2 razy poprawnie (3 formy)
                if (correctAnswersTracker[verbId] >= 2) {
                    console.log(`DEBUG: USUWAM SOWO - warunek speniony: poprawnych odpowiedzi ${correctAnswersTracker[verbId]}/2`);
                    console.log(`Usuwam sowo "${currentVerb.polish}" z puli, indeks: ${currentVerbIndex}, dugo przed: ${currentVerbs.length}`);
                    
                    // R贸wnie偶 usuwamy sowo z listy niepoprawnych (jeli tam jest)
                    const incorrectIndex = incorrectVerbs.findIndex(v => v.infinitive === verbId);
                    if (incorrectIndex !== -1) {
                        console.log(`Usuwam sowo "${currentVerb.polish}" z listy niepoprawnych, indeks: ${incorrectIndex}`);
                        incorrectVerbs.splice(incorrectIndex, 1);
                        console.log(`Po usuniciu, liczba niepoprawnych: ${incorrectVerbs.length}`);
                    }
                    
                    // Wydrukuj informacj o sowach niepoprawnych, dla atwiejszego debugowania
                    console.log("Lista s贸w niepoprawnych po usuniciu:");
                    incorrectVerbs.forEach((v, i) => {
                        console.log(`${i+1}. ${v.polish} (${v.infinitive})`);
                    });
                    
                    // Jeli wszystkie odpowiedzi s poprawne 2 razy, usuwamy sowo z puli
                    currentVerbs.splice(currentVerbIndex, 1);
                    console.log(`Po usuniciu, dugo: ${currentVerbs.length}`);
                    
                    // UWAGA: Nie zmieniamy currentVerbIndex, poniewa偶:
                    // 1. Jeli usunlimy element, to element na tej samej pozycji jest teraz inny
                    // 2. Zapobiegamy przeskakiwaniu s贸w w powt贸rce
                    
                    // Sprawdzamy, czy indeks nie wyszed poza zakres po usuniciu
                    if (currentVerbIndex >= currentVerbs.length && currentVerbs.length > 0) {
                        console.log("Indeks poza zakresem po usuniciu, korygowanie...");
                        // Jeli tak, to ustawiamy na ostatni element
                        currentVerbIndex = currentVerbs.length - 1;
                    }
                    
                    return true;
                } else {
                    console.log(`DEBUG: NIE USUWAM SOWA - warunek niespeniony: poprawnych odpowiedzi ${correctAnswersTracker[verbId]}/2`);
                    return false;
                }
            }
            return false;
        }
        
        // Funkcja do wywietlania informacji o stanie aplikacji (do debugowania)
        function logAppState() {
            console.log("===== STAN APLIKACJI =====");
            console.log("Aktualna liczba s贸w w puli:", currentVerbs.length);
            if (currentVerbs.length > 0) {
                console.log("Sowa w puli:", currentVerbs.map(v => v.polish).join(", "));
            }
            console.log("Aktualny indeks:", currentVerbIndex);
            console.log("Liczba niepoprawnych s贸w:", incorrectVerbs.length);
            if (incorrectVerbs.length > 0) {
                console.log("Niepoprawne sowa:", incorrectVerbs.map(v => v.polish).join(", "));
            }
            
            // Liczniki poprawnych odpowiedzi
            console.log("Liczniki poprawnych odpowiedzi:");
            for (const [word, count] of Object.entries(correctAnswersTracker)) {
                if (count > 0) {
                    const verbObj = currentVerbs.find(v => v.infinitive === word) || 
                                    incorrectVerbs.find(v => v.infinitive === word) ||
                                    allBlockWords.find(v => v.infinitive === word);
                    const polish = verbObj ? verbObj.polish : '(nieznane)';
                    console.log(`- ${polish} (${word}): ${count}/2`);
                }
            }
              console.log("===========================");
        }
        
        // Funkcja walidujca list niepoprawnych s贸w
        function validateIncorrectVerbs() {
            console.log("Rozpoczynam walidacj listy niepoprawnych s贸w...");
            console.log("Pocztkowa liczba s贸w:", incorrectVerbs.length);
            
            if (incorrectVerbs.length === 0) {
                console.log("Lista jest pusta, nie ma nic do walidacji.");
                return 0;
            }
            
            // Sprawdzenie, czy nie ma duplikat贸w
            const uniqueVerbs = [];
            const duplicates = [];
            const uniqueInfinitives = new Set();
            
            for (const verb of incorrectVerbs) {
                if (uniqueInfinitives.has(verb.infinitive)) {
                    duplicates.push(verb);
                } else {
                    uniqueInfinitives.add(verb.infinitive);
                    uniqueVerbs.push(verb);
                }
            }
            
            if (duplicates.length > 0) {
                console.error("UWAGA: Wykryto duplikaty na licie niepoprawnych s贸w!");
                console.error("Duplikaty:", duplicates.map(v => `${v.polish} (${v.infinitive})`).join(", "));
                
                // Usunicie duplikat贸w
                incorrectVerbs = uniqueVerbs;
                console.log("Usunito duplikaty, aktualna liczba s贸w:", incorrectVerbs.length);
            }
            
            // Sprawdzenie, czy wszystkie sowa maj poprawn struktur
            const invalidVerbs = incorrectVerbs.filter(v => 
                !v.infinitive || !v.preterite || !v.perfect || !v.polish
            );
            
            if (invalidVerbs.length > 0) {
                console.error("UWAGA: Wykryto niepoprawne sowa na licie niepoprawnych!");
                console.error("Niepoprawne sowa:", invalidVerbs);
                
                // Usunicie niepoprawnych s贸w
                incorrectVerbs = incorrectVerbs.filter(v => 
                    v.infinitive && v.preterite && v.perfect && v.polish
                );
                console.log("Usunito niepoprawne sowa, aktualna liczba s贸w:", incorrectVerbs.length);
            }
            
            // Sprawd藕, czy wszystkie sowa z oryginalnego bloku s w puli
            if (allBlockWords.length > 0 && incorrectVerbs.length < allBlockWords.length) {
                console.warn("UWAGA: Brakuje s贸w w licie niepoprawnych! Naprawiam...");
                
                // Znajd藕 brakujce sowa
                const incorrectVerbsInfinitives = incorrectVerbs.map(v => v.infinitive);
                const missingWords = allBlockWords.filter(w => !incorrectVerbsInfinitives.includes(w.infinitive));
                
                if (missingWords.length > 0) {
                    console.warn("Brakujce sowa:", missingWords.map(w => `${w.polish} (${w.infinitive})`).join(", "));
                    
                    // Dodaj brakujce sowa do listy niepoprawnych
                    console.log("Dodaj brakujce sowa do listy niepoprawnych");
                    incorrectVerbs = incorrectVerbs.concat(JSON.parse(JSON.stringify(missingWords)));
                    console.log("Po dodaniu brakujcych s贸w, liczba s贸w:", incorrectVerbs.length);
                }
            }
            
            // Logowanie ka偶dego sowa po walidacji dla weryfikacji
            console.log("Stan listy po walidacji:");
            incorrectVerbs.forEach((verb, idx) => {
                console.log(`${idx + 1}. ${verb.polish} (${verb.infinitive}, ${verb.preterite}, ${verb.perfect})`);
            });
            
            console.log("Walidacja zakoczona. Finalna liczba s贸w:", incorrectVerbs.length);
            return incorrectVerbs.length;
        }
    </script>
</body>
</html>
